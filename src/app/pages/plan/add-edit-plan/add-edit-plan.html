<div class="main-container">
    <div class="card">

        <div class="actions ms-auto d-flex flex-wrap gap-2">
            <button type="button" class="btn-action btn-outline" (click)="goBack()">
                <mat-icon class="msr">arrow_back</mat-icon>
                <span class="btn-text">Back</span>
            </button>
        </div>

        <div class="card-body">
            <h5 class="mb-4">{{title}}</h5>
            <form [formGroup]="form" class="row g-3">

                <!-- Plan Name -->
                <div class="col-md-6">
                    <label class="form-label">Plan Name <span class="text-danger">*</span></label>
                    <input type="text" class="form-control" formControlName="planName" placeholder="Enter plan name">
                    @if (form.get('planName')?.touched && form.get('planName')?.invalid) {
                    <div class="text-danger small mt-1">
                        @if (form.get('planName')?.hasError('required')) {
                        Plan Name is required.
                        }
                    </div>
                    }
                </div>

                <!-- Actions -->
                <div class="col-12">
                    <label class="form-label fw-bold mb-2">Program Action Links</label>
                    <div class="d-flex flex-column gap-3 p-3 rounded program-action-list">
                        @for (program of actionList; track program.programId) {
                        <div class="program-group">
                            <p style="font-weight: 500;">{{ program.programName }}</p>
                            <div class="d-flex flex-wrap gap-3 ms-3">
                                @for (action of program.action; track action.actionLinkId) {
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" [value]="action.actionLinkId"
                                        [id]="'action-' + action.actionLinkId"
                                        [checked]="isChecked(action.actionLinkId)"
                                        (change)="onActionChange($event, action.actionLinkId)">
                                    <label class="form-check-label" [for]="'action-' + action.actionLinkId">
                                        {{ action.actionName }}
                                    </label>
                                </div>
                                }
                            </div>
                        </div>
                        }
                        @if (actionList.length === 0) {
                        <div class="text-muted small">
                            No programs/actions available.
                        </div>
                        }
                    </div>
                </div>

                <!-- Buttons -->
                <div class="col-12 mt-4 d-flex justify-content-end gap-2">
                    <mat-dialog-actions class="mt-4">
                        <button type="button" class="close-btn" (click)="goBack()">Cancel</button>
                        <button class="submit-btn" type="submit" [disabled]="submitting" (click)="onSubmit()">
                            @if (submitting) {
                            <span class="btn-loader"></span>
                            }
                            Save Plan
                        </button>
                    </mat-dialog-actions>
                </div>
            </form>
        </div>
    </div>
</div>