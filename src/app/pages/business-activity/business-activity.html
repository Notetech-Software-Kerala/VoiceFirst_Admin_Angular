<div class="card">
    <h2 class="page-title mb-3">Business Activity Management</h2>

    <div class="d-flex flex-wrap align-items-center mb-3 gap-2">

        <!-- Left: search + filters -->
        <div class="d-flex flex-wrap align-items-center gap-2 flex-grow-1">
            <app-search-bar [tooltipText]="'Search by name'" [(value)]="searchText" (valueChange)="applyFilter()">
            </app-search-bar>

            <!-- <app-filter-by
      [filters]="filterOptions"
      [activeFilters]="activeFilters"
      [clearSignal]="clearSignal"
      (filterChange)="onFilterChange($event)">
    </app-filter-by> -->
        </div>

        <!-- Actions -->
        <div class="actions ms-auto d-flex flex-wrap gap-2">


            <input #fileInput type="file" accept=".csv" class="d-none" />
            <label class="btn-action btn-outline" for="fileInput">
                <mat-icon class="msr">file_upload</mat-icon>
                <span class="btn-text">Import</span>
            </label>


            <button type="button" class="btn-action btn-outline">
                <mat-icon class="msr">file_download</mat-icon>
                <span class="btn-text">Export</span>
            </button>


            <button type="button" class="btn-action btn-outline">
                <mat-icon class="msr">insert_chart</mat-icon>
                <span class="btn-text">Report</span>
            </button>


            <button type="button" class="btn-action btn-primary" (click)="openDialog()">
                <mat-icon class="msr">add</mat-icon>
                <span class="btn-text">Add</span>
            </button>

        </div>
    </div>


    @let entries = activeFilters | keyvalue;

    @if (entries.length) {
    <div class="active-filters d-flex flex-wrap align-items-center gap-2 mb-3">
        @for (entry of entries; track entry.key) {
        @for (val of entry.value; track val) {
        <span class="filter-chip">
            {{ val }}
            <button type="button" class="btn-clear" (click)="removeFilter(entry.key, val)">×</button>
        </span>
        }
        }
        <button type="button" class="btn btn-sm btn-outline-secondary ms-2" (click)="clearAllFilters()">
            Clear all
        </button>
    </div>
    }

    <div class="table-responsive position-relative">
        <div *ngIf="loading$ | async" class="progress position-absolute top-0 start-0 end-0" role="progressbar"
            aria-label="Loading" style="z-index: 10; height: 3px; background-color: #ffffff;">
            <div class="table-premium-loader"></div>
        </div>
        <table class="table align-middle">
            <thead class="table-light">
                <tr>
                    <th>Name <small style="cursor:pointer" (click)="sortData('Name')">⇅</small></th>

                    <th>Status</th>

                    <th>Action</th>
            </thead>

            <tbody>
                @for (u of paginatedBuisnessActivity; track u) {
                <tr>
                    <td>{{ u.Name }}</td>


                    <td>
                        <span class="badge" [ngClass]="{
          'badge--deleted': u.Delete,
          'badge--active': !u.Delete && u.Active,
          'badge--suspended': !u.Delete && !u.Active
        }">
                            {{ u.Delete ? 'Deleted' : (u.Active ? 'Active' : 'Suspended') }}
                        </span>
                    </td>

                    <td class="action-cell">
                        <button mat-icon-button class="menu-trigger" [matMenuTriggerFor]="rowMenu"
                            aria-label="More actions">
                            <mat-icon class="msr">more_vert</mat-icon>
                        </button>

                        <mat-menu #rowMenu="matMenu" class="row-menu" xPosition="before" yPosition="below">

                            <button mat-menu-item (click)="openDialog(u)">
                                <mat-icon class="msr-edit">edit</mat-icon>
                                <span>Edit</span>
                            </button>

                            <button mat-menu-item (click)="onDelete(u)">
                                <mat-icon class="msr-delete">delete</mat-icon>
                                <span>Delete</span>
                            </button>

                        </mat-menu>
                    </td>


                </tr>
                }

                @if (paginatedBuisnessActivity.length === 0) {
                <tr>
                    <td colspan="6" class="text-center p-3">
                        @if (loading$ | async) {
                        <small class="loading-text">Please wait...</small>

                        } @else {
                        <small class="no-data-text">No data found</small>
                        }
                    </td>
                </tr>
                }
            </tbody>
        </table>
    </div>

    <app-pagination [totalItems]="filteredBuisnessActivity.length" [pageSize]="pageSize" [pageSizes]="pageSizes"
        [currentPage]="currentPage" (pageChange)="changePage($event)" (pageSizeChange)="changePageSize($event)">
    </app-pagination>
</div>